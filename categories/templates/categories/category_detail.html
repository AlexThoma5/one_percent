{% extends "base.html" %}
{% load static %} 
{% load crispy_forms_tags %}
{% block content %}
<div class="container">
  <!-- Category Header -->
  <div class="mb-4 text-center">
    <h1 class="display-5 welcome">{{ category.name }}</h1>
  </div>
  <!-- Logs Section -->
  <h2 class="h4 mb-3 welcome text-center">Logs</h2>
  <!-- Create new logs button -->
  <div class="row justify-content-center pb-3 text-start">
    <div class="col-12">
      <button
        class="btn btn-primary"
        data-bs-toggle="modal"
        data-bs-target="#addLogModal"
      >
        Add Entry
      </button>
    </div>
  </div>
  {% if logs %}
  <div class="row g-3">
    {% for log in logs %}
    <div class="col-12 col-md-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start gap-3">
            <div>
              <p class="card-title mb-1 fw-semibold log-title h5" id="logTitle{{ log.id }}">
                {{ log.title }}
              </p>
              <p class="text-muted small mb-2">
                {{ log.created_on |date:"d M Y â€¢ H:i A" }}
              </p>
            </div>
            <div class="icon-width">
              {% if user.is_authenticated and log.user == user %}
              <button
                type="button"
                class="text-secondary me-2 edit-pen icon-btn-style btn-edit"
                log_id="{{ log.id }}"
              >
                <i class="fa-solid fa-pen grow"></i>
              </button>
              <a href="" class="text-danger"
                ><i class="fa-solid fa-trash grow"></i
              ></a>
              {% endif %}
            </div>
          </div>
          <p class="card-text mt-2 mb-0 text-muted" id='log{{ log.id }}'>{{ log.content }}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info">No logs available for this category yet.</div>
  {% endif %}
</div>

<!-- Bootstrap Modal for adding logs -->
<div
  class="modal fade"
  id="addLogModal"
  tabindex="-1"
  aria-labelledby="addLogModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post" id="logForm">
        {% csrf_token %}
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">
            Add {{ category.name }} log
          </h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body container">
          <div class="row justify-content-center p-2">
            <div class="col">{{ log_form | crispy }}</div>
          </div>
        </div>
        <!-- Modal footer -->
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Close
          </button>
          <button id="submitButton" type="submit" class="btn btn-danger">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bootstrap Modal for editing logs -->
<div
  class="modal fade"
  id="editLogModal"
  tabindex="-1"
  aria-labelledby="editLogModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post" id="editLogForm">
        {% csrf_token %}
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="editLogModalLabel">
            Edit {{ category.name }} log
          </h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body container">
          <div class="row justify-content-center p-2">
            <div class="col">{{ log_form | crispy }}</div>
          </div>
        </div>
        <!-- Modal footer -->
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button id="submitButton" type="submit" class="btn btn-danger">
            Update
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock content %}
{% block extras %}
<script src="{% static 'js/logs.js' %}"></script>
{% endblock %}
